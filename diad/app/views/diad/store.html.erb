<html xmlns="http://www.w3.org/1999/html">
<head>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
  <title>DeathisaDialogue | Official Site</title>
  <%= stylesheet_link_tag    'application', 'diadmain', media: 'all', 'data-turbolinks-track' => true %>
  <%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>
  <%= csrf_meta_tags %>
  <%= favicon_link_tag 'favicon.png' %>
  <script type="text/javascript" src="https://js.squareup.com/v2/paymentform"></script>
  <script>
    var paymentForm = new SqPaymentForm({
      applicationId: 'sandbox-sq0idp-YIDR4JFlIVezYhbQtF3eSA', // <-- Add your application ID here
      inputClass: 'sq-input',
      inputStyles: [
        {
          fontSize: '15px'
        },
      ],
      cardNumber: {
        elementId: 'sq-card-number',
        placeholder: '•••• •••• •••• ••••'
      },
      cvv: {
        elementId: 'sq-cvv',
        placeholder: 'CVV'
      },
      expirationDate: {
        elementId: 'sq-expiration-date',
        placeholder: 'MM/YY'
      },
      postalCode: {
        elementId: 'sq-postal-code'
      },
      callbacks: {
        cardNonceResponseReceived: function(errors, nonce, cardData) {
          if (errors) {
            // handle errors
            errors.forEach(function(error) { console.log(error.message); });
          } else {
            // handle nonce
            //alert('Nonce received! ' + nonce + ' ' + JSON.stringify(cardData));
            // Assign the value of the nonce to a hidden form element
            var nonceField = document.getElementById("card_nonce");
            nonceField.value = nonce;
            // Submit the form
            console.log('Nonce received!');
             // console.log(nonce);
            document.getElementById("number").submit();
          }
        },
        unsupportedBrowserDetected: function() {
          // Alert the buyer that their browser is not supported
        },
        inputEventReceived: function(inputEvent) {
          switch (inputEvent.eventType) {
            case 'focusClassAdded':
              // Handle as desired
              break;
            case 'focusClassRemoved':
              // Handle as desired
              break;
            case 'errorClassAdded':
              // Handle as desired
              break;
            case 'errorClassRemoved':
              // Handle as desired
              break;
            case 'cardBrandChanged':
              // Handle as desired
              break;
            case 'postalCodeChanged':
              // Handle as desired
              break;
          }
        }
      }
    });

    function requestCardNonce() {
      paymentForm.requestCardNonce();

    }
  </script>
  <style type="text/css">
    .sq-input {
      border: 0px solid rgb(223, 223, 223);
      outline-offset: -2px;
      margin-bottom: 5px;
      margin-left: 30%;
      margin-right: 30%;
    }
    .sq-input--focus {
      /* how your inputs should appear when they have focus */
      outline: 5px auto rgb(59, 153, 252);
    }
    .sq-input--error {
      /* how your inputs should appear when invalid */
      outline: 5px auto rgb(255, 97, 97);
    }
  </style>
</head>
<body class="navbargrey">
      <div class="fontset">
        <table class="table table-condensed">
          <thead>
          <tr>
            <th style="width:50%">Product</th>
            <th style="width:10%">Price</th>
            <th style="width:8%">Quantity</th>
            <th style="width:22%" class="text-center">Subtotal</th>
            <th style="width:10%"></th>
          </tr>
          </thead>
          <tbody>
          <tr>
            <td data-th="Product">
              <div class="row">
                <div class="col-sm-2 hidden-xs"><img src="http://placehold.it/100x100" alt="..." class="img-responsive"/></div>
                <div class="col-sm-10">
                  <h4 class="nomargin"><%= Item.first.name %></h4>
                  <p><%= Item.first.description %></p>
                </div>
              </div>
            </td>
            <td data-th="Price">$1.99</td>
            <td data-th="Quantity">
              <input type="number" class="form-control text-center" value="1">
            </td>
            <td data-th="Subtotal" class="text-center">1.99</td>
            <td class="actions" data-th="">
              <button class="btn btn-info btn-sm"><i class="fa fa-refresh"></i></button>
              <button class="btn btn-danger btn-sm"><i class="fa fa-trash-o"></i></button>
            </td>
          </tr>
          </tbody>
         </table>
      </div>
      <div class="sq-input">
      <label>Card Number</label>
      <div id="sq-card-number"></div>
      <label>CVV</label>
      <div id="sq-cvv"></div>
      <label>Expiration Date</label>
      <div id="sq-expiration-date"></div>
      <label>Postal Code</label>
      <div id="sq-postal-code"></div>

      <button class="btn-primary" type="submit" onclick="requestCardNonce()">Confirm</button>
        </div>
<!--      <form id="form" novalidate method="post">
      <input type="hidden" id="card-nonce" name="nonce">
      <input type="submit" onclick="submitButtonClick(event)" id="card-nonce">
      </form> -->
        <div id="card-nonce">
        <%= form_tag diad_store_checkout_path, id: "number", multipart: true do %>
        <%= text_field_tag :card_nonce, nil, :class => "sr-only" %>
        <%= submit_tag 'Confirm', method: 'POST', remote: :true, :class => "sr-only" %>
        <% end %>
        </div>


      <div id="errors"></div>

</body>

</html>
