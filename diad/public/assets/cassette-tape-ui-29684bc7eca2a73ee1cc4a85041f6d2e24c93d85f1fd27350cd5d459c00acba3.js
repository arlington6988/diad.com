!function(e){function t(e,t,n,o,r,a){function l(){var e,t,a=n,l=o,i=n,s=o;return c[0].width=a,c[0].height=l,c[1].width=i,c[1].height=s,e=[c[0].getContext("2d"),c[1].getContext("2d")],r?(t=e[0].createPattern(u[0],"repeat"),e[0].fillStyle=t,e[0].fillRect(0,0,i,s),e[0].fillStyle=""):e[0].drawImage(u[0],0,0),e[1].drawImage(u[1],0,0),e[0].globalCompositeOperation="destination-in",e[0].drawImage(c[1],0,0),e[0].globalCompositeOperation=null,c[0]}function s(){if(this.onload=this.onerror=null,f++,f>=m){try{var e="/png";a(l().toDataURL(e))}catch(t){if("undefined"!=typeof console&&"undefined"!=typeof console.warn&&(console.warn("Unable to apply image mask, likely a security exception from offline (file://) use.",t),i||"undefined"==typeof console.info||console.info("Using static skin image as a workaround.")),i)a();else{var n="/assets/ma-r90-body-skin-9edeac5844a4cc770c12f394bb1c398bafc8076332ea8e78ca75695797a508f8.png";a(n),i=!0}}c=null,u=null}}function d(){u[0].onload=u[0].onerror=s,u[1].onload=u[1].onerror=s,u[0].src=e,u[1].src=t}var u=[new Image,new Image],c=[document.createElement("canvas"),document.createElement("canvas")],f=0,m=u.length;d()}function n(n){function o(e){var t,n="backgroundImage";return t=e.currentStyle?e.currentStyle[n]:document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(e,"")[n]:e.style[n],t=t.replace("url(","").replace(")",""),t=t.replace(/\'/g,"").replace(/\"/g,"")}function a(e,t){e&&t&&(e.style.backgroundImage=t)}function l(e){var n=o(e),r=e.offsetWidth,l=e.offsetHeight,i=!!e.getAttribute("data-image-repeat"),s=e.getAttribute("data-mask-url");return t(n,s,r,l,i,function(t){var n=t?"url("+t+")":null;a(e,n)})}function i(e){return e*B}function d(e){return e*U}function u(e){if(!R.node.className.match(/cutout/i))return!1;A=document.createElement("canvas"),q=new Image,A.width=B,A.height=U,q.onload=function(){var t=A.getContext("2d");t.drawImage(this,0,0),this.onload=null,P=!0,e()};var t="/assets/ma-r90-body-skin-9edeac5844a4cc770c12f394bb1c398bafc8076332ea8e78ca75695797a508f8.png";q.src=t}function m(e){var t=o(document.getElementsByTagName("html")[0]),n=new Image;n.onload=n.onerror=function(){if(this.width||this.height){var t=new s(R.blurNode,this);R.blurNode.style.backgroundImage="",t.blur(2)}this.onload=this.onerror=null,e&&e()},n.src=t}function g(){if(!c.data.dragTarget.node)return!1;var t,n,o=e.innerWidth,r=parseInt(o/2,10),a=e.innerHeight,l=parseInt(a/2,10),i=R.node,s=R.blurNode;i&&(t=parseInt(r-B/2,10),n=parseInt(l-U/2,10),i.style.left=t+"px",i.style.top=n+"px",s&&(s.style.marginLeft=-t+"px",s.style.marginTop=-n+"px"))}function p(){f.css.add(R.node,M.ready),f.css.add(R.node,M.dropin),D&&e.clearTimeout(D),D=e.setTimeout(function(){f.css.remove(R.node,M.dropin)},1e3)}function v(){var t=document.getElementById("tape-loader"),n=document.getElementById("demo-header-wrapper");t&&(f.css.remove(t,"visible"),f.css.add(t,"hidden"),n&&f.css.add(n,"visible")),e.setTimeout(function(){g(),p(t)},t?300:1)}function h(){var e,t;if(E=n.sound,R={node:n.node,canvas:n.node.querySelectorAll(".connecting-tape"),reels:n.node.querySelectorAll("div.reel"),spokes:n.node.querySelectorAll("div.spokes"),label:n.node.querySelectorAll("div.label"),maskImages:n.node.querySelectorAll(".image-mask"),blurNode:n.node.querySelectorAll(".blur-image")},R.canvas&&R.canvas.length?(R.canvas=R.canvas[0],u(function(){I(0,!0)})):R.canvas=null,R.maskImages)for(e=0,t=R.maskImages.length;t>e;e++)l(R.maskImages[e]);R.blurNode&&R.blurNode.length?(R.blurNode=R.blurNode[0],m(v)):(R.blurNode=null,v()),S=new r(R,E)}function y(e,t,n){var o=0;n=Math.min(1,Math.max(0,n));var r,a=Math.floor(W*n);return V[e].borderWidth!==a&&(V[e].borderWidth=a,t.style.borderWidth=a+"px",r=-(Math.floor(L/2)+a)+"px",t.style.marginLeft=r,t.style.marginTop=r,o=1),o}function w(e){return Math.PI/180*e}function b(e,t,n){var o=W-W*t,r=W*t,a=d(.998),l={left:Math.floor(i(.29)-L/2-o)+4,top:d(.42)},s=16,u={left:Math.floor(i(.71)+L/2+r)-3,top:d(.42)},c={left:i(.11)-s,top:a-2*s},f={left:i(.89)-s,top:a},m={from:[c.left,c.top],to:[l.left,l.top]},g={from:[f.left,f.top],to:[u.left,u.top]},p={left:.5*B,top:a};if(!n&&H.leftReel.left===l.left&&H.rightReel.left===u.left)return!1;H.leftReel.left=l.left,H.rightReel.left=u.left;var v=e.getContext("2d");e.width=B,e.height=U,v.beginPath(),v.moveTo(p.left,p.top),v.lineTo(m.from[0]+s,m.from[1]+2*s),v.arc(m.from[0]+s,m.from[1]+s,s,w(90),w(180),!1),v.lineTo(l.left,l.top),v.lineWidth=.5,v.moveTo(p.left,p.top),v.lineTo(g.from[0]+s,g.from[1]),v.arc(g.from[0]+s,g.from[1]-s,s,w(90),w(0),!0),v.lineTo(u.left,u.top),v.lineWidth=1,v.stroke(),A&&(v.globalCompositeOperation="destination-out",v.drawImage(A,0,0),v.globalCompositeOperation=null,P&&!C&&(C=!0,e.style.visibility="visible"))}function x(){}function T(e){var t=0;return x(R.reels[0],e),t+=y(0,R.reels[0],1-e),t+=y(1,R.reels[1],e)}function I(e,t){var n=0;t=t||!1,O.progress=e,n=T(e),(n||t)&&R.canvas&&b(R.canvas,e,t)}function N(){f.css.remove(R.node,M.stopped),f.css.add(R.node,M.playing)}function k(){f.css.remove(R.node,M.playing),f.css.add(R.node,M.stopped)}var S,E,A,P,q,C,M={playing:"playing",stopped:"stopped",ready:"ready",dropin:"dropin"},O={progress:0},R={},L=91,W=76,B=480,U=parseInt(B/1.6,10),D=null,V=[{borderWidth:null},{borderWidth:null}],H={leftReel:{left:null},rightReel:{left:null}};return{refreshBlurImage:function(e){return f.css.remove(R.node,M.dropin),f.css.remove(R.node,M.ready),m(function(){f.css.add(R.node,M.dropin),f.css.add(R.node,M.ready),p(),e&&e(this)})},dom:R,init:h,setProgress:I,start:N,stop:k}}function o(){for(var e=d.length;e--;)d[e].setProgress(0)}function r(e,t){function n(){f.events.add(r.o,"mousedown",a.mousedown),f.events.add(e.node,"click",a.click)}function o(){i=soundManager.ok(),r.o=e.node.querySelector(".controls"),r.play=r.o.querySelector(".play"),r.rewind=r.o.querySelector(".rew"),r.ffwd=r.o.querySelector(".ffwd"),r.stop=r.o.querySelector(".stop"),n()}var t,r,a,l,i,s=.033;r={oControls:null,play:null,rew:null,ffwd:null,stop:null},a={mousedown:function(e){var t=(e.target,e.target.className);return i&&"undefined"!=typeof l[t]?(l[t](e),a.stopEvent(e)):void 0},stopEvent:function(e){return e.preventDefault(),!1},click:function(e){if(u)return u=!1,a.stopEvent(e);var n=(e.target,e.target.className);return"undefined"!=typeof l[n]?a.mousedown(e):void t.togglePause()}},l={play:function(){t.play()},rew:function(){var e=Math.max(0,t.position-t.duration*s);t.duration&&(t.setPosition(e),d[0].setProgress(e/t.duration))},ffwd:function(){var e;t.duration&&(e=Math.min(t.duration,t.position+t.duration*s),t.setPosition(e))},stop:function(){t.pause()}},o()}function a(){function e(){for(var e=d.length;e--;)d[e].start()}function t(){for(var e=d.length;e--;)d[e].stop()}var r="undefined"!=typeof document.createElement("canvas").getContext;if(!r)return!1;var a,l,i;for(c.init(),soundManager.ok()&&(i=soundManager.createSound({id:"tapeSound",url:"/assets/beep2-ee256e043f487de4c36df7f3960eaa42e87e09c16a947c7413f430465094ca7d.mp3",multiShot:!1,whileplaying:function(){for(var e=d.length;e--;)d[e].setProgress(this.position/this.durationEstimate)},onplay:e,onfinish:t,onpause:t,onresume:e})),a=document.querySelectorAll("div.tape"),l=a.length;l--;)d.push(new n({node:a[l],sound:i})),d[d.length-1].init();o()}function l(){var t=document.getElementById("tape-loader");t&&(t.className="visible"),e.setTimeout(function(){a()},20)}var i=!1,s=function(e,t){var n,o;this.image=t,n=this.image.width,o=this.image.height,this.element=e||document.createElement("canvas"),this.element.style.width=n+"px",this.element.style.height=o+"px",this.element.width=n,this.element.height=o,this.context=this.element.getContext("2d"),this.context.drawImage(this.image,0,0)};s.prototype={blur:function(e){this.context.globalAlpha=.5;for(var t=-e;e>=t;t+=2)for(var n=-e;e>=n;n+=2)this.context.drawImage(this.element,n,t),n>=0&&t>=0&&this.context.drawImage(this.element,-(n-1),-(t-1));this.context.globalAlpha=1}};var d=[],u=!1,c=function(){function t(e){var t=curtop=0;if(e.offsetParent)do t+=e.offsetLeft,curtop+=e.offsetTop;while(e=e.offsetParent);return[t,curtop]}function n(){a.dragTarget&&a.dragTarget.node&&f.events.add(a.dragTarget.node,"mousedown",l.mousedown)}function o(){a.dragTarget.node=document.querySelector(".tape.draggable"),a.dragTarget.blurNode=document.querySelector(".tape.draggable .blur-image"),n()}var r,a,l;return r={dragActive:"dragging",dropActive:"dropping"},a={dragTarget:{node:null,blurNode:null,blurNodeContainer:null,x:null,y:null,lastX:null,lastY:null},mousedown:{x:null,y:null},drag:{xOffset:null,yOffset:null},background:{xOffset:-151,yOffset:-119}},l={mousedown:function(e){var n=a.dragTarget.node,o=e.target;if(!a.dragTarget.node)return!0;if(o&&"INPUT"==o.tagName)return u=!0,!0;u=!1;var r=t(n);return a.dragTarget.x=r[0],a.dragTarget.y=r[1],a.mousedown.x=e.clientX,a.mousedown.y=e.clientY,a.drag.xOffset=a.mousedown.x-a.dragTarget.x,a.drag.yOffset=a.mousedown.y-a.dragTarget.y,f.events.add(document,"mousemove",l.mousemove),f.events.add(document,"mouseup",l.mouseup),e.preventDefault(),!1},mousemove:function(e){var t,n,o=a.dragTarget.node,l=a.dragTarget.blurNode;o&&(t=e.clientX-a.drag.xOffset,n=e.clientY-a.drag.yOffset,o.style.left=t+"px",o.style.top=n+"px",l&&(l.style.marginLeft=-t+"px",l.style.marginTop=-n+"px"),u||(u=!0,f.css.add(a.dragTarget.node,r.dragActive)))},mouseup:function(t){return f.css.remove(a.dragTarget.node,r.dragActive),u&&(f.css.add(a.dragTarget.node,r.dropActive),e.setTimeout(function(){f.css.remove(a.dragTarget.node,r.dropActive)},500)),f.events.remove(document,"mousemove",l.mousemove),f.events.remove(document,"mouseup",l.mouseup),t.preventDefault(),!1}},{data:a,init:o}}(),f=function(){var t="undefined"!=typeof e.addEventListener?function(e,t,n){return e.addEventListener(t,n,!1)}:function(e,t,n){e.attachEvent("on"+t,n)},n="undefined"!=typeof e.removeEventListener?function(e,t,n){return e.removeEventListener(t,n,!1)}:function(e,t,n){return e.detachEvent("on"+t,n)},o=function(e,t){return"undefined"!=typeof e.className?e.className.match(new RegExp("(s|^)"+t+"(s|$)")):!1},r=function(e,t){return e&&t&&!o(e,t)?void(e.className=(e.className?e.className+" ":"")+t):!1},a=function(e,t){return e&&t&&!o(e,t)?void(e.className=e.className.replace(new RegExp("( "+t+")|("+t+")","g"),"")):!1};return{css:{has:o,add:r,remove:a},events:{add:t,remove:n}}}();soundManager.setup({url:"assets/swfs/",flashVersion:9,useHighPerformance:!0,preferFlash:!1,html5PollingInterval:50,onready:l,ontimeout:l}),e.tapeUIs=d}(window);